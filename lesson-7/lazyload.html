<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./styles/styles.css">
  <title>Lesson 7</title>
</head>

<body>
  <h1>Images</h1>
  <img src="./images/placeholder.png" data-src="https://picsum.photos/300/400" alt="placeholder">
  <img src="./images/placeholder.png" data-src="https://picsum.photos/300/400" alt="placeholder">
  <img src="./images/placeholder.png" data-src="https://picsum.photos/300/400" alt="placeholder">
  <img src="./images/placeholder.png" data-src="https://picsum.photos/300/400" alt="placeholder">
  <img src="./images/placeholder.png" data-src="https://picsum.photos/300/400" alt="placeholder">
  <img src="./images/placeholder.png" data-src="https://picsum.photos/300/400" alt="placeholder">

  <script>
    if ("IntersectionObserver" in window) {

      const images = document.querySelectorAll('[data-src]')

      const preloadImage = (img) => {
        const dataSrc = img.getAttribute('data-src')
        console.log("ðŸš€ ~ file: lazyload.html ~ line 28 ~ preloadImage ~ dataSrc", dataSrc)

        if (!dataSrc) {
          return
        }

        img.src = dataSrc
      }

      const imgOptions = {}

      const imgObserver = new IntersectionObserver((entries, imgObserver) => {

        entries.forEach(({ target, isIntersecting }) => {
          if (!isIntersecting) {
            console.log('no');
            return;
          }
          console.log('si');
          preloadImage(target)

          imgObserver.unobserve(target)
        })
      }, imgOptions)

      images.forEach(image => {
        imgObserver.observe(image)
      })
    }

  </script>
</body>

</html>